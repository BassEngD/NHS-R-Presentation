<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>presentation1.utf8.md</title>
    <meta charset="utf-8" />
    <link href="presentation1_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <script src="presentation1_files/htmlwidgets-1.5.1/htmlwidgets.js"></script>
    <script src="presentation1_files/jquery-1.12.4/jquery.min.js"></script>
    <link href="presentation1_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="presentation1_files/datatables-binding-0.9/datatables.js"></script>
    <link href="presentation1_files/dt-core-1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="presentation1_files/dt-core-1.10.19/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="presentation1_files/dt-core-1.10.19/js/jquery.dataTables.min.js"></script>
    <link href="presentation1_files/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
    <script src="presentation1_files/crosstalk-1.0.0/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="matt1.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">


# APIs in R
## Matthew Bass
### Healthcare Evaluation Data (HED),&lt;br&gt;University Hospitals Birmingham (UHB)
## 27/09/2019
Matthew.Bass@uhb.nhs.uk

???

+ Using R for ~6 months
+ Learned by saying "Let's use R for that"

---

## API What?

&lt;center&gt;

&lt;p&gt;"Application Programming Interface"&lt;/p&gt;

???

Sounds complex, but is really...

--

&lt;p&gt;`=`&lt;/p&gt;

&lt;p&gt;Method for one thing to talk to another thing&lt;/p&gt;

???

+ servers and clients
+ databases
+ sounds like...

--

&lt;p&gt;`=`&lt;/p&gt;

&lt;p&gt;Websites&lt;/p&gt;

&lt;/center&gt;

???

+ client sends request
+ server sends reply
+ reply contains website

---

## Surfing the World Wide Web


```r
# R uses a library called httr to control sending
# and recieving HTTP requests
library(httr)

# The command you will use the most for APIs is GET()
# This command will return the reply from the server
# as a list.

webpage.raw &lt;- GET(url="https://www.google.com")
```

???

+ Access websites in R
+ httr
+ GET()
+ Let's get google...

---

## Get: google.com

![Google Home Page](pres-figure/Google_screen_shot.png)

???

what we are expecting

---

## Got: Whatever This Is


```
## List of 10
##  $ url        : chr "https://www.google.com"
##  $ status_code: int 200
##  $ headers    :List of 11
##   ..$ date             : chr "Fri, 01 Nov 2019 08:59:06 GMT"
##   ..$ expires          : chr "-1"
##   ..$ cache-control    : chr "private, max-age=0"
##   ..$ content-type     : chr "text/html; charset=ISO-8859-1"
##   ..$ content-encoding : chr "gzip"
##   ..$ server           : chr "gws"
##   ..$ x-xss-protection : chr "0"
##   ..$ x-frame-options  : chr "SAMEORIGIN"
##   ..$ set-cookie       : chr "1P_JAR=2019-11-01-08; expires=Sun, 01-Dec-2019 08:59:06 GMT; path=/; domain=.google.com; SameSite=none"
##   ..$ alt-svc          : chr "quic=\":443\"; ma=2592000; v=\"46,43\",h3-Q049=\":443\"; ma=2592000,h3-Q048=\":443\"; ma=2592000,h3-Q046=\":443"| __truncated__
##   ..$ transfer-encoding: chr "chunked"
##   ..- attr(*, "class")= chr [1:2] "insensitive" "list"
##  $ all_headers:List of 1
##   ..$ :List of 3
##   .. ..$ status : int 200
##   .. ..$ version: chr "HTTP/1.1"
##   .. ..$ headers:List of 11
##   .. .. ..$ date             : chr "Fri, 01 Nov 2019 08:59:06 GMT"
##   .. .. ..$ expires          : chr "-1"
##   .. .. ..$ cache-control    : chr "private, max-age=0"
##   .. .. ..$ content-type     : chr "text/html; charset=ISO-8859-1"
##   .. .. ..$ content-encoding : chr "gzip"
##   .. .. ..$ server           : chr "gws"
##   .. .. ..$ x-xss-protection : chr "0"
##   .. .. ..$ x-frame-options  : chr "SAMEORIGIN"
##   .. .. ..$ set-cookie       : chr "1P_JAR=2019-11-01-08; expires=Sun, 01-Dec-2019 08:59:06 GMT; path=/; domain=.google.com; SameSite=none"
##   .. .. ..$ alt-svc          : chr "quic=\":443\"; ma=2592000; v=\"46,43\",h3-Q049=\":443\"; ma=2592000,h3-Q048=\":443\"; ma=2592000,h3-Q046=\":443"| __truncated__
##   .. .. ..$ transfer-encoding: chr "chunked"
##   .. .. ..- attr(*, "class")= chr [1:2] "insensitive" "list"
##  $ cookies    :'data.frame':	2 obs. of  7 variables:
##   ..$ domain    : chr [1:2] ".google.com" "#HttpOnly_.google.com"
##   ..$ flag      : logi [1:2] TRUE TRUE
##   ..$ path      : chr [1:2] "/" "/"
##   ..$ secure    : logi [1:2] FALSE FALSE
##   ..$ expiration: POSIXct[1:2], format: "2019-12-01 08:59:06" ...
##   ..$ name      : chr [1:2] "1P_JAR" "NID"
##   ..$ value     : chr [1:2] "2019-11-01-08" "190=HXtmnK_-oGFpj0ZjCuq17p1C9exrD8JJ-qsGJQZPLdkt41dCnTgSs4J2Tceb7bYiuxextOMZk3v2_slVMCebvTYh2jVcBICO7Ge1xZKQx4i"| __truncated__
##  $ content    : raw [1:11619] 3c 21 64 6f ...
##  $ date       : POSIXct[1:1], format: "2019-11-01 08:59:06"
##  $ times      : Named num [1:6] 0 0.00365 0.03639 0.14744 0.34834 ...
##   ..- attr(*, "names")= chr [1:6] "redirect" "namelookup" "connect" "pretransfer" ...
##  $ request    :List of 7
##   ..$ method    : chr "GET"
##   ..$ url       : chr "https://www.google.com"
##   ..$ headers   : Named chr "application/json, text/xml, application/xml, */*"
##   .. ..- attr(*, "names")= chr "Accept"
##   ..$ fields    : NULL
##   ..$ options   :List of 2
##   .. ..$ useragent: chr "libcurl/7.64.1 r-curl/4.2 httr/1.4.1"
##   .. ..$ httpget  : logi TRUE
##   ..$ auth_token: NULL
##   ..$ output    : list()
##   .. ..- attr(*, "class")= chr [1:2] "write_memory" "write_function"
##   ..- attr(*, "class")= chr "request"
##  $ handle     :Class 'curl_handle' &lt;externalptr&gt; 
##  - attr(*, "class")= chr "response"
```

???

and this is what we get from httr

---

## HTTP Replies

- url
- status_code
- request
- cookies
- content

???

+ the url you asked for
+ status codes like 404. 200 means success
+ any extra stuff you sent
+ content!

---

## Content


```
##    [1] 3c 21 64 6f 63 74 79 70 65 20 68 74 6d 6c 3e 3c 68 74 6d 6c 20 69 74
##   [24] 65 6d 73 63 6f 70 65 3d 22 22 20 69 74 65 6d 74 79 70 65 3d 22 68 74
##   [47] 74 70 3a 2f 2f 73 63 68 65 6d 61 2e 6f 72 67 2f 57 65 62 50 61 67 65
##   [70] 22 20 6c 61 6e 67 3d 22 65 6e 2d 47 42 22 3e 3c 68 65 61 64 3e 3c 6d
##   [93] 65 74 61 20 63 6f 6e 74 65 6e 74 3d 22 74 65 78 74 2f 68 74 6d 6c 3b
##  [116] 20 63 68 61 72 73 65 74 3d 55 54 46 2d 38 22 20 68 74 74 70 2d 65 71
##  [139] 75 69 76 3d 22 43 6f 6e 74 65 6e 74 2d 54 79 70 65 22 3e 3c 6d 65 74
##  [162] 61 20 63 6f 6e 74 65 6e 74 3d 22 2f 69 6d 61 67 65 73 2f 62 72 61 6e
##  [185] 64 69 6e 67 2f 67 6f 6f 67 6c 65 67 2f 31 78 2f 67 6f 6f 67 6c 65 67
##  [208] 5f 73 74 61 6e 64 61 72 64 5f 63 6f 6c 6f 72 5f 31 32 38 64 70 2e 70
##  [231] 6e 67 22 20 69 74 65 6d 70 72 6f 70 3d 22 69 6d 61 67 65 22 3e 3c 74
##  [254] 69 74 6c 65 3e 47 6f 6f 67 6c 65 3c 2f 74 69 74 6c 65 3e 3c 73 63 72
##  [277] 69 70 74 20 6e 6f 6e 63 65 3d 22 46 35 70 39 70 46 78 43 55 4c 57 46
##  [300] 76 36 74 64 63 6e 33 72 34 51 3d 3d 22 3e 28 66 75 6e 63 74 69 6f 6e
##  [323] 28 29 7b 77 69 6e 64 6f 77 2e 67 6f 6f 67 6c 65 3d 7b 6b 45 49 3a 27
##  [346] 32 76 4f 37 58 64 7a 4c 4a 34 2d 6b 77 51 4b 6a 74 62 69 59 44 77 27
##  [369] 2c 6b 45 58 50 49 3a 27 30 2c 31 33 35 33 37 34 37 2c 35 36 36 32 2c
##  [392] 37 33 31 2c 32 32 33 2c 35 31 30 2c 31 38 2c 31 30 34 37 2c 32 30 38
##  [415] 32 2c 31 30 37 30 2c 33 37 38 2c 32 30 36 2c 31 30 31 37 2c 35 33 2c
##  [438] 31 33 34 34 2c 37 39 30 2c 31 30 2c 37 31 33 2c 32 37 31 2c 36 37 2c
##  [461] 39 36 2c 31 31 38 2c 34 34 2c 35 2c 32 35 36 2c 32 30 2c 39 32 38 2c
##  [484] 32 36 2c 31 36 35 2c 37 39 2c 32 33 37 2c 34 2c 31 31 33 30 34 38 38
##  [507] 2c 31 34 33 2c 31 31 39 37 37 31 30 2c 33 31 33 2c 31 32 36 2c 31 39
##  [530] 2c 33 32 39 30 39 39 2c 31 32 39 34 2c 31 32 33 38 33 2c 34 38 35 35
##  [553] 2c 33 32 36 39 32 2c 31 35 32 34 37 2c 38 36 37 2c 31 38 35 34 34 2c
##  [576] 33 33 33 35 2c 32 2c 32 2c 36 38 30 31 2c 33 36 39 2c 33 33 31 34 2c
##  [599] 35 35 30 35 2c 32 32 34 2c 32 32 31 38 2c 35 39 34 32 2c 31 31 31 39
##  [622] 2c 32 2c 35 37 39 2c 37 32 37 2c 32 34 33 32 2c 31 33 36 31 2c 34 33
##  [645] 32 33 2c 34 39 36 37 2c 37 37 34 2c 32 32 35 31 2c 31 34 30 36 2c 33
##  [668] 33 33 37 2c 31 31 34 36 2c 39 2c 39 38 31 2c 39 38 32 2c 36 31 39 36
##  [691] 2c 31 37 31 39 2c 31 38 30 38 2c 31 39 37 36 2c 32 30 34 34 2c 38 39
##  [714] 30 39 2c 35 30 37 31 2c 32 32 36 2c 32 30 31 36 2c 33 38 2c 39 32 30
##  [737] 2c 38 37 33 2c 31 32 31 37 2c 32 39 37 35 2c 32 37 33 36 2c 34 39 2c
##  [760] 31 35 30 39 2c 31 35 30 36 2c 32 2c 36 32 38 2c 32 34 30 33 2c 38 33
##  [783] 37 2c 34 31 34 2c 37 30 33 32 2c 36 32 30 2c 32 38 38 33 2c 32 31 2c
##  [806] 33 31 37 2c 33 31 37 33 2c 39 37 35 2c 31 2c 33 36 39 2c 31 33 39 38
##  [829] 2c 31 33 37 39 2c 39 31 39 2c 39 39 32 2c 31 32 38 35 2c 38 2c 33 37
##  [852] 36 33 2c 36 30 31 2c 31 31 2c 31 34 2c 31 32 37 39 2c 32 32 31 32 2c
##  [875] 32 30 32 2c 33 32 33 2c 35 2c 31 32 35 32 2c 38 34 30 2c 33 32 34 2c
##  [898] 31 39 33 2c 33 31 37 2c 39 34 36 2c 32 31 31 2c 34 38 2c 31 35 38 2c
##  [921] 36 36 32 2c 33 34 33 38 2c 31 30 39 2c 31 35 31 2c 35 32 2c 31 31 33
##  [944] 36 2c 33 2c 32 30 36 33 2c 36 30 36 2c 31 38 33 39 2c 31 38 34 2c 35
##  [967] 34 34 2c 35 31 2c 31 31 38 32 2c 31 34 33 2c 33 37 37 2c 36 38 36 2c
##  [990] 31 30 37 31 2c 31 39 30 2c 37 34
##  [ reached getOption("max.print") -- omitted 10619 entries ]
```

???

it's machine code.jpg

---

## Content.Decoded


```r
# content() is part of httr
content(webpage.raw, "text")
```

???

use another part of httr. content().

--


```
## [1] "&lt;!doctype html&gt;&lt;html itemscope=\"\" itemtype=\"http://schema.org/WebPage\" lang=\"en-GB\"&gt;&lt;head&gt;&lt;meta content=\"text/html; charset=UTF-8\" http-equiv=\"Content-Type\"&gt;&lt;meta content=\"/images/branding/googleg/1x/googleg_standard_color_128dp.png\" itemprop=\"image\"&gt;&lt;title&gt;Google&lt;/title&gt;&lt;script nonce=\"F5p9pFxCULWFv6tdcn3r4Q==\"&gt;(function(){window.google={kEI:'2vO7XdzLJ4-kwQKjtbiYDw',kEXPI:'0,1353747,5662,731,223,510,18,1047,2082,1070,378,206,1017,53,1344,790,10,713,271,67,96,118,44,5,256,20,928,26,165,79,237,4,1130488,143,1197710,313,126,19,329099,1294,12383,4855,32692,15247,867,18544,3335,2,2,6801,369,3314,5505,224,2218,5942,1119,2,579,727,2432,1361,4323,4967,774,2251,1406,3337,1146,9,981,982,6196,1719,1808,1976,2044,8909,5071,226,2016,38,920,873,1217,2975,2736,49,1509,1506,2,628,2403,837,414,7032,620,2883,21,317,3173,975,1,369,1398,1379,919,992,1285,8,3763,601,11,14,1279,2212,202,323,5,1252,840,324,193,317,946,211,48,158,662,3438,109,151,52,1136,3,2063,606,1839,184,544,51,1182,143,377,686,1071,190,747,429,44,207,1,801,93,328,1284,16,85,335,81,774,1652,2247,473,290,1049,29,719,1039,3094,133,773,909,639,524,7,728,592,1574,436,4303,3,766,4992,12,25,49,614,52,299,911,1377,3,499,215,367,170,192,614,64,517,312,213,1177,282,1000,770,246,42,566,410,654,841,727,488,13,766,872,41,186,45,1176,955,184,294,52,7,126,296,197,118,206,212,441,203,43,61,174,447,142,134,86,1756,6,184,469,1008,233,94,77,378,127,217,30,1,1,436,10,443,324,2,8,575,94,5875794,13,3119,1802762,4194854,2799592,4,1572,549,333,444,1,2,80,1,900,583,9,304,1,8,1,2,2551,1,748,141,59,736,563,1,4079,185,1,1,1,1,1,137,1,5,18,7,1,1,10,3,1,17,2,17,1,1,13,1,1,11,2,50,4,22302565,1662865',authuser:0,kscs:'c9c918f0_2vO7XdzLJ4-kwQKjtbiYDw',kGL:'GB',kBL:'9qAG'};google.sn='webhp';google.kHL='en-GB';google.jsfs='Ffpdje';})();(function(){google.lc=[];google.li=0;google.getEI=function(a){for(var b;a&amp;&amp;(!a.getAttribute||!(b=a.getAttribute(\"eid\")));)a=a.parentNode;return b||google.kEI};google.getLEI=function(a){for(var b=null;a&amp;&amp;(!a.getAttribute||!(b=a.getAttribute(\"leid\")));)a=a.parentNode;return b};google.https=function(){return\"https:\"==window.location.protocol};google.ml=function(){return null};google.time=function(){return(new Date).getTime()};google.log=function(a,b,e,c,g){if(a=google.logUrl(a,b,e,c,g)){b=new Image;var d=google.lc,f=google.li;d[f]=b;b.onerror=b.onload=b.onabort=function(){delete d[f]};google.vel&amp;&amp;google.vel.lu&amp;&amp;google.vel.lu(a);b.src=a;google.li=f+1}};google.logUrl=function(a,b,e,c,g){var d=\"\",f=google.ls||\"\";e||-1!=b.search(\"&amp;ei=\")||(d=\"&amp;ei=\"+google.getEI(c),-1==b.search(\"&amp;lei=\")&amp;&amp;(c=google.getLEI(c))&amp;&amp;(d+=\"&amp;lei=\"+c));c=\"\";!e&amp;&amp;google.cshid&amp;&amp;-1==b.search(\"&amp;cshid=\")&amp;&amp;\"slh\"!=a&amp;&amp;(c=\"&amp;cshid=\"+google.cshid);a=e||\"/\"+(g||\"gen_204\")+\"?atyp=i&amp;ct=\"+a+\"&amp;cad=\"+b+d+f+\"&amp;zx=\"+google.time()+c;/^http:/i.test(a)&amp;&amp;google.https()&amp;&amp;(google.ml(Error(\"a\"),!1,{src:a,glmm:1}),a=\"\");return a};}).call(this);(function(){google.y={};google.x=function(a,b){if(a)var c=a.id;else{do c=Math.random();while(google.y[c])}google.y[c]=[a,b];return!1};google.lm=[];google.plm=function(a){google.lm.push.apply(google.lm,a)};google.lq=[];google.load=function(a,b,c){google.lq.push([[a],b,c])};google.loadAll=function(a,b){google.lq.push([a,b])};}).call(this);google.f={};var a=window.location,b=a.href.indexOf(\"#\");if(0&lt;=b){var c=a.href.substring(b+1);/(^|&amp;)q=/.test(c)&amp;&amp;-1==c.indexOf(\"#\")&amp;&amp;a.replace(\"/search?\"+c.replace(/(^|&amp;)fp=[^&amp;]*/g,\"\")+\"&amp;cad=h\")};&lt;/script&gt;&lt;style&gt;#gbar,#guser{font-size:13px;padding-top:1px !important;}#gbar{height:22px}#guser{padding-bottom:7px !important;text-align:right}.gbh,.gbd{border-top:1px solid #c9d7f1;font-size:1px}.gbh{height:0;position:absolute;top:24px;width:100%}@media all{.gb1{height:22px;margin-right:.5em;vertical-align:top}#gbar{float:left}}a.gb1,a.gb4{text-decoration:underline !important}a.gb1,a.gb4{color:#00c !important}.gbi .gb4{color:#dd8e27 !important}.gbf .gb4{color:#900 !important}\n&lt;/style&gt;&lt;style&gt;body,td,a,p,.h{font-family:arial,sans-serif}body{margin:0;overflow-y:scroll}#gog{padding:3px 8px 0}td{line-height:.8em}.gac_m td{line-height:17px}form{margin-bottom:20px}.h{color:#36c}.q{color:#00c}.ts td{padding:0}.ts{border-collapse:collapse}em{font-weight:bold;font-style:normal}.lst{height:25px;width:496px}.gsfi,.lst{font:18px arial,sans-serif}.gsfs{font:17px arial,sans-serif}.ds{display:inline-box;display:inline-block;margin:3px 0 4px;margin-left:4px}input{font-family:inherit}a.gb1,a.gb2,a.gb3,a.gb4{color:#11c !important}body{background:#fff;color:black}a{color:#11c;text-decoration:none}a:hover,a:active{text-decoration:underline}.fl a{color:#36c}a:visited{color:#551a8b}a.gb1,a.gb4{text-decoration:underline}a.gb3:hover{text-decoration:none}#ghead a.gb2:hover{color:#fff !important}.sblc{padding-top:5px}.sblc a{display:block;margin:2px 0;margin-left:13px;font-size:11px}.lsbb{background:#eee;border:solid 1px;border-color:#ccc #999 #999 #ccc;height:30px}.lsbb{display:block}.ftl,#fll a{display:inline-block;margin:0 12px}.lsb{background:url(/images/nav_logo229.png) 0 -261px repeat-x;border:none;color:#000;cursor:pointer;height:30px;margin:0;outline:0;font:15px arial,sans-serif;vertical-align:top}.lsb:active{background:#ccc}.lst:focus{outline:none}&lt;/style&gt;&lt;script nonce=\"F5p9pFxCULWFv6tdcn3r4Q==\"&gt;&lt;/script&gt;&lt;/head&gt;&lt;body bgcolor=\"#fff\"&gt;&lt;script nonce=\"F5p9pFxCULWFv6tdcn3r4Q==\"&gt;(function(){var src='/images/nav_logo229.png';var iesg=false;document.body.onload = function(){window.n &amp;&amp; window.n();if (document.images){new Image().src=src;}\nif (!iesg){document.f&amp;&amp;document.f.q.focus();document.gbqf&amp;&amp;document.gbqf.q.focus();}\n}\n})();&lt;/script&gt;&lt;div id=\"mngb\"&gt; &lt;div id=gbar&gt;&lt;nobr&gt;&lt;b class=gb1&gt;Search&lt;/b&gt; &lt;a class=gb1 href=\"https://www.google.co.uk/imghp?hl=en&amp;tab=wi\"&gt;Images&lt;/a&gt; &lt;a class=gb1 href=\"https://maps.google.co.uk/maps?hl=en&amp;tab=wl\"&gt;Maps&lt;/a&gt; &lt;a class=gb1 href=\"https://play.google.com/?hl=en&amp;tab=w8\"&gt;Play&lt;/a&gt; &lt;a class=gb1 href=\"https://www.youtube.com/?gl=GB&amp;tab=w1\"&gt;YouTube&lt;/a&gt; &lt;a class=gb1 href=\"https://news.google.co.uk/nwshp?hl=en&amp;tab=wn\"&gt;News&lt;/a&gt; &lt;a class=gb1 href=\"https://mail.google.com/mail/?tab=wm\"&gt;Gmail&lt;/a&gt; &lt;a class=gb1 href=\"https://drive.google.com/?tab=wo\"&gt;Drive&lt;/a&gt; &lt;a class=gb1 style=\"text-decoration:none\" href=\"https://www.google.co.uk/intl/en/about/products?tab=wh\"&gt;&lt;u&gt;More&lt;/u&gt; &amp;raquo;&lt;/a&gt;&lt;/nobr&gt;&lt;/div&gt;&lt;div id=guser width=100%&gt;&lt;nobr&gt;&lt;span id=gbn class=gbi&gt;&lt;/span&gt;&lt;span id=gbf class=gbf&gt;&lt;/span&gt;&lt;span id=gbe&gt;&lt;/span&gt;&lt;a href=\"http://www.google.co.uk/history/optout?hl=en\" class=gb4&gt;Web History&lt;/a&gt; | &lt;a  href=\"/preferences?hl=en\" class=gb4&gt;Settings&lt;/a&gt; | &lt;a target=_top id=gb_70 href=\"https://accounts.google.com/ServiceLogin?hl=en&amp;passive=true&amp;continue=https://www.google.com/\" class=gb4&gt;Sign in&lt;/a&gt;&lt;/nobr&gt;&lt;/div&gt;&lt;div class=gbh style=left:0&gt;&lt;/div&gt;&lt;div class=gbh style=right:0&gt;&lt;/div&gt; &lt;/div&gt;&lt;center&gt;&lt;br clear=\"all\" id=\"lgpd\"&gt;&lt;div id=\"lga\"&gt;&lt;img alt=\"Google\" height=\"92\" src=\"/images/branding/googlelogo/1x/googlelogo_white_background_color_272x92dp.png\" style=\"padding:28px 0 14px\" width=\"272\" id=\"hplogo\"&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;form action=\"/search\" name=\"f\"&gt;&lt;table cellpadding=\"0\" cellspacing=\"0\"&gt;&lt;tr valign=\"top\"&gt;&lt;td width=\"25%\"&gt;&amp;nbsp;&lt;/td&gt;&lt;td align=\"center\" nowrap=\"\"&gt;&lt;input name=\"ie\" value=\"ISO-8859-1\" type=\"hidden\"&gt;&lt;input value=\"en-GB\" name=\"hl\" type=\"hidden\"&gt;&lt;input name=\"source\" type=\"hidden\" value=\"hp\"&gt;&lt;input name=\"biw\" type=\"hidden\"&gt;&lt;input name=\"bih\" type=\"hidden\"&gt;&lt;div class=\"ds\" style=\"height:32px;margin:4px 0\"&gt;&lt;input style=\"color:#000;margin:0;padding:5px 8px 0 6px;vertical-align:top\" autocomplete=\"off\" class=\"lst\" value=\"\" title=\"Google Search\" maxlength=\"2048\" name=\"q\" size=\"57\"&gt;&lt;/div&gt;&lt;br style=\"line-height:0\"&gt;&lt;span class=\"ds\"&gt;&lt;span class=\"lsbb\"&gt;&lt;input class=\"lsb\" value=\"Google Search\" name=\"btnG\" type=\"submit\"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=\"ds\"&gt;&lt;span class=\"lsbb\"&gt;&lt;input class=\"lsb\" id=\"tsuid1\" value=\"I'm Feeling Lucky\" name=\"btnI\" type=\"submit\"&gt;&lt;script nonce=\"F5p9pFxCULWFv6tdcn3r4Q==\"&gt;(function(){var id='tsuid1';document.getElementById(id).onclick = function(){if (this.form.q.value){this.checked = 1;if (this.form.iflsig)this.form.iflsig.disabled = false;}\nelse top.location='/doodles/';};})();&lt;/script&gt;&lt;input value=\"AAP1E1EAAAAAXbwB6gKajew3oEfVbk75hj3GZ5TXAi0Q\" name=\"iflsig\" type=\"hidden\"&gt;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;&lt;td class=\"fl sblc\" align=\"left\" nowrap=\"\" width=\"25%\"&gt;&lt;a href=\"/advanced_search?hl=en-GB&amp;amp;authuser=0\"&gt;Advanced search&lt;/a&gt;&lt;a href=\"/language_tools?hl=en-GB&amp;amp;authuser=0\"&gt;Language tools&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;input id=\"gbv\" name=\"gbv\" type=\"hidden\" value=\"1\"&gt;&lt;script nonce=\"F5p9pFxCULWFv6tdcn3r4Q==\"&gt;(function(){var a,b=\"1\";if(document&amp;&amp;document.getElementById)if(\"undefined\"!=typeof XMLHttpRequest)b=\"2\";else if(\"undefined\"!=typeof ActiveXObject){var c,d,e=[\"MSXML2.XMLHTTP.6.0\",\"MSXML2.XMLHTTP.3.0\",\"MSXML2.XMLHTTP\",\"Microsoft.XMLHTTP\"];for(c=0;d=e[c++];)try{new ActiveXObject(d),b=\"2\"}catch(h){}}a=b;if(\"2\"==a&amp;&amp;-1==location.search.indexOf(\"&amp;gbv=2\")){var f=google.gbvu,g=document.getElementById(\"gbv\");g&amp;&amp;(g.value=a);f&amp;&amp;window.setTimeout(function(){location.href=f},0)};}).call(this);&lt;/script&gt;&lt;/form&gt;&lt;div id=\"gac_scont\"&gt;&lt;/div&gt;&lt;div style=\"font-size:83%;min-height:3.5em\"&gt;&lt;br&gt;&lt;/div&gt;&lt;span id=\"footer\"&gt;&lt;div style=\"font-size:10pt\"&gt;&lt;div style=\"margin:19px auto;text-align:center\" id=\"fll\"&gt;&lt;a href=\"/intl/en/ads/\"&gt;AdvertisingÂ Programmes&lt;/a&gt;&lt;a href=\"/services/\"&gt;Business Solutions&lt;/a&gt;&lt;a href=\"/intl/en/about.html\"&gt;About Google&lt;/a&gt;&lt;a href=\"https://www.google.com/setprefdomain?prefdom=GB&amp;amp;prev=https://www.google.co.uk/&amp;amp;sig=K_4jofx0Cwgucbxdwh4isrS1eE5Lw%3D\"&gt;Google.co.uk&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;p style=\"color:#767676;font-size:8pt\"&gt;&amp;copy; 2019 - &lt;a href=\"/intl/en/policies/privacy/\"&gt;Privacy&lt;/a&gt; - &lt;a href=\"/intl/en/policies/terms/\"&gt;Terms&lt;/a&gt;&lt;/p&gt;&lt;/span&gt;&lt;/center&gt;&lt;script nonce=\"F5p9pFxCULWFv6tdcn3r4Q==\"&gt;(function(){window.google.cdo={height:0,width:0};(function(){var a=window.innerWidth,b=window.innerHeight;if(!a||!b){var c=window.document,d=\"CSS1Compat\"==c.compatMode?c.documentElement:c.body;a=d.clientWidth;b=d.clientHeight}a&amp;&amp;b&amp;&amp;(a!=google.cdo.width||b!=google.cdo.height)&amp;&amp;google.log(\"\",\"\",\"/client_204?&amp;atyp=i&amp;biw=\"+a+\"&amp;bih=\"+b+\"&amp;ei=\"+google.kEI);}).call(this);})();(function(){var u='/xjs/_/js/k\\x3dxjs.hp.en.ROlaAI3IRqg.O/m\\x3dsb_he,d/am\\x3dwCCwEQ/d\\x3d1/rs\\x3dACT90oEXtbiI_E0XFHYSh6KhzikOonl56A';setTimeout(function(){var a=document.createElement(\"script\");a.src=u;google.timers&amp;&amp;google.timers.load&amp;&amp;google.tick&amp;&amp;google.tick(\"load\",\"xjsls\");document.body.appendChild(a)},0);})();(function(){window.google.xjsu='/xjs/_/js/k\\x3dxjs.hp.en.ROlaAI3IRqg.O/m\\x3dsb_he,d/am\\x3dwCCwEQ/d\\x3d1/rs\\x3dACT90oEXtbiI_E0XFHYSh6KhzikOonl56A';})();function _DumpException(e){throw e;}\nfunction _F_installCss(c){}\n(function(){google.spjs=false;google.snet=true;google.em=[];google.emw=false;})();(function(){var pmc='{\\x22d\\x22:{},\\x22sb_he\\x22:{\\x22agen\\x22:true,\\x22cgen\\x22:true,\\x22client\\x22:\\x22heirloom-hp\\x22,\\x22dh\\x22:true,\\x22dhqt\\x22:true,\\x22ds\\x22:\\x22\\x22,\\x22ffql\\x22:\\x22en\\x22,\\x22fl\\x22:true,\\x22host\\x22:\\x22google.com\\x22,\\x22isbh\\x22:28,\\x22jsonp\\x22:true,\\x22msgs\\x22:{\\x22cibl\\x22:\\x22Clear Search\\x22,\\x22dym\\x22:\\x22Did you mean:\\x22,\\x22lcky\\x22:\\x22I\\\\u0026#39;m Feeling Lucky\\x22,\\x22lml\\x22:\\x22Learn more\\x22,\\x22oskt\\x22:\\x22Input tools\\x22,\\x22psrc\\x22:\\x22This search was removed from your \\\\u003Ca href\\x3d\\\\\\x22/history\\\\\\x22\\\\u003EWeb History\\\\u003C/a\\\\u003E\\x22,\\x22psrl\\x22:\\x22Remove\\x22,\\x22sbit\\x22:\\x22Search by image\\x22,\\x22srch\\x22:\\x22Google Search\\x22},\\x22ovr\\x22:{},\\x22pq\\x22:\\x22\\x22,\\x22refpd\\x22:true,\\x22rfs\\x22:[],\\x22sbpl\\x22:24,\\x22sbpr\\x22:24,\\x22scd\\x22:10,\\x22sce\\x22:5,\\x22stok\\x22:\\x22o2NsIzAXUATUDsmt3dErbS3Lskw\\x22,\\x22uhde\\x22:false}}';google.pmc=JSON.parse(pmc);})();&lt;/script&gt;        &lt;/body&gt;&lt;/html&gt;"
```

???

+ Success, we have html.
+ summary - send request with GET, decode reply with content().

---

## NHS Organisation Data Service (ODS)

Note: I am not affiliated in any way with the ODS
![NHS ODS Front page](pres-figure/ODS_screen_shot.png)

???

+ ODS keeps track of all the organisation codes, structures, relationships, addresses, etc.
+ I am not part of it, I'm just using their API
+ Wanted to update our databases quickly

---

## NHS ODS ORD API


```r
# The API gives the url of the 'Endpoint':
#   the address to send requests to the server.
url &lt;- "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations?"

GET(url = url)
```

???

+ NHS Acronymns.
+ First part is Website you can visit. Not all APIs do that, but many do.
+ organisations? is the **endpoint** for looking up organisation data

--


```
## Response [https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations?]
##   Date: 2019-11-01 09:26
##   Status: 406
##   Content-Type: application/json
##   Size: 92 B
## {
##   "errorCode": 406, 
##   "errorText": "Supplied query must include some query parameters"
## }
```

???

+ helpful error message. We need parameters.

---

## Add Parameters


```r
# Parameters go on the end
url &lt;- "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations?PostCode=B15"

GET(url = url)
```

```
## Response [https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations?PostCode=B15]
##   Date: 2019-11-01 08:59
##   Status: 200
##   Content-Type: application/json
##   Size: 6.35 kB
```

???

+ Add the parameters on the end, after the ?.
+ Need to know the API to know what parameters can be used.
+ Added postcode.

---

## Our First API Reply


```r
url &lt;- "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations?PostCode=B15"
API.raw &lt;- GET(url = url)
API.decoded &lt;- content(API.raw)
str(API.decoded)
```

```
## List of 1
##  $ Organisations:List of 20
##   ..$ :List of 9
##   .. ..$ Name                  : chr "115 GOUGH ROAD"
##   .. ..$ OrgId                 : chr "VL8YY"
##   .. ..$ Status                : chr "Active"
##   .. ..$ OrgRecordClass        : chr "RC1"
##   .. ..$ PostCode              : chr "B15 2JG"
##   .. ..$ LastChangeDate        : chr "2019-07-19"
##   .. ..$ PrimaryRoleId         : chr "RO101"
##   .. ..$ PrimaryRoleDescription: chr "SOCIAL CARE SITE"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VL8YY"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "115 GOUGH ROAD (CARE HOME)"
##   .. ..$ OrgId                 : chr "VL8YE"
##   .. ..$ Status                : chr "Inactive"
##   .. ..$ OrgRecordClass        : chr "RC1"
##   .. ..$ PostCode              : chr "B15 2JG"
##   .. ..$ LastChangeDate        : chr "2018-11-26"
##   .. ..$ PrimaryRoleId         : chr "RO101"
##   .. ..$ PrimaryRoleDescription: chr "SOCIAL CARE SITE"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VL8YE"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "21A ELVETHAM ROAD"
##   .. ..$ OrgId                 : chr "VLQYV"
##   .. ..$ Status                : chr "Inactive"
##   .. ..$ OrgRecordClass        : chr "RC1"
##   .. ..$ PostCode              : chr "B15 2LY"
##   .. ..$ LastChangeDate        : chr "2018-11-26"
##   .. ..$ PrimaryRoleId         : chr "RO101"
##   .. ..$ PrimaryRoleDescription: chr "SOCIAL CARE SITE"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VLQYV"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "21B ELVETHAM ROAD"
##   .. ..$ OrgId                 : chr "VLQYW"
##   .. ..$ Status                : chr "Inactive"
##   .. ..$ OrgRecordClass        : chr "RC1"
##   .. ..$ PostCode              : chr "B15 2LY"
##   .. ..$ LastChangeDate        : chr "2018-11-26"
##   .. ..$ PrimaryRoleId         : chr "RO101"
##   .. ..$ PrimaryRoleDescription: chr "SOCIAL CARE SITE"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VLQYW"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "21 ELVETHAM ROAD"
##   .. ..$ OrgId                 : chr "VLW3V"
##   .. ..$ Status                : chr "Active"
##   .. ..$ OrgRecordClass        : chr "RC1"
##   .. ..$ PostCode              : chr "B15 2LY"
##   .. ..$ LastChangeDate        : chr "2019-07-19"
##   .. ..$ PrimaryRoleId         : chr "RO101"
##   .. ..$ PrimaryRoleDescription: chr "SOCIAL CARE SITE"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VLW3V"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "22A &amp; 22B ELVETHAM ROAD"
##   .. ..$ OrgId                 : chr "RWLC6"
##   .. ..$ Status                : chr "Inactive"
##   .. ..$ OrgRecordClass        : chr "RC2"
##   .. ..$ PostCode              : chr "B15 2LY"
##   .. ..$ LastChangeDate        : chr "2013-05-08"
##   .. ..$ PrimaryRoleId         : chr "RO198"
##   .. ..$ PrimaryRoleDescription: chr "NHS TRUST SITE"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RWLC6"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "27 HIGHFIELD ROAD"
##   .. ..$ OrgId                 : chr "Q2701"
##   .. ..$ Status                : chr "Inactive"
##   .. ..$ OrgRecordClass        : chr "RC2"
##   .. ..$ PostCode              : chr "B15 3DP"
##   .. ..$ LastChangeDate        : chr "2013-05-08"
##   .. ..$ PrimaryRoleId         : chr "RO136"
##   .. ..$ PrimaryRoleDescription: chr "STRATEGIC HEALTH AUTHORITY SITE"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/Q2701"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "ADDICTIVE BEHAVIOURS UNIT (CHURCH RD)"
##   .. ..$ OrgId                 : chr "RXT02"
##   .. ..$ Status                : chr "Active"
##   .. ..$ OrgRecordClass        : chr "RC2"
##   .. ..$ PostCode              : chr "B15 3SR"
##   .. ..$ LastChangeDate        : chr "2013-05-08"
##   .. ..$ PrimaryRoleId         : chr "RO198"
##   .. ..$ PrimaryRoleDescription: chr "NHS TRUST SITE"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RXT02"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "ALLENBROOK HOME (HALESOWEN) LTD"
##   .. ..$ OrgId                 : chr "AYR6"
##   .. ..$ Status                : chr "Active"
##   .. ..$ OrgRecordClass        : chr "RC1"
##   .. ..$ PostCode              : chr "B15 3HN"
##   .. ..$ LastChangeDate        : chr "2019-06-04"
##   .. ..$ PrimaryRoleId         : chr "RO104"
##   .. ..$ PrimaryRoleDescription: chr "SOCIAL CARE PROVIDER"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/AYR6"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "ALLIANCE MEDICAL MRI SERVICE - BIRMINGHAM"
##   .. ..$ OrgId                 : chr "NT941"
##   .. ..$ Status                : chr "Active"
##   .. ..$ OrgRecordClass        : chr "RC2"
##   .. ..$ PostCode              : chr "B15 2QQ"
##   .. ..$ LastChangeDate        : chr "2016-03-23"
##   .. ..$ PrimaryRoleId         : chr "RO176"
##   .. ..$ PrimaryRoleDescription: chr "INDEPENDENT SECTOR H/C PROVIDER SITE"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/NT941"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "AMBERLEIGH CARE HOME LTD"
##   .. ..$ OrgId                 : chr "APQJ"
##   .. ..$ Status                : chr "Inactive"
##   .. ..$ OrgRecordClass        : chr "RC1"
##   .. ..$ PostCode              : chr "B15 3UR"
##   .. ..$ LastChangeDate        : chr "2019-07-18"
##   .. ..$ PrimaryRoleId         : chr "RO104"
##   .. ..$ PrimaryRoleDescription: chr "SOCIAL CARE PROVIDER"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/APQJ"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "ANNIE BRIGHT"
##   .. ..$ OrgId                 : chr "VL8W0"
##   .. ..$ Status                : chr "Inactive"
##   .. ..$ OrgRecordClass        : chr "RC1"
##   .. ..$ PostCode              : chr "B15 3QD"
##   .. ..$ LastChangeDate        : chr "2018-11-26"
##   .. ..$ PrimaryRoleId         : chr "RO101"
##   .. ..$ PrimaryRoleDescription: chr "SOCIAL CARE SITE"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VL8W0"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "ANNIE BRIGHT WESTON HOUSE"
##   .. ..$ OrgId                 : chr "VL4YJ"
##   .. ..$ Status                : chr "Inactive"
##   .. ..$ OrgRecordClass        : chr "RC1"
##   .. ..$ PostCode              : chr "B15 3QD"
##   .. ..$ LastChangeDate        : chr "2018-11-26"
##   .. ..$ PrimaryRoleId         : chr "RO101"
##   .. ..$ PrimaryRoleDescription: chr "SOCIAL CARE SITE"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VL4YJ"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "AQP ANTICOAG QE HERITAGE BUILDING"
##   .. ..$ OrgId                 : chr "Y04762"
##   .. ..$ Status                : chr "Active"
##   .. ..$ OrgRecordClass        : chr "RC1"
##   .. ..$ PostCode              : chr "B15 2WB"
##   .. ..$ LastChangeDate        : chr "2018-04-18"
##   .. ..$ PrimaryRoleId         : chr "RO177"
##   .. ..$ PrimaryRoleDescription: chr "PRESCRIBING COST CENTRE"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/Y04762"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "ASPEN HILL HEALTHCARE LIMITED"
##   .. ..$ OrgId                 : chr "C07D"
##   .. ..$ Status                : chr "Active"
##   .. ..$ OrgRecordClass        : chr "RC1"
##   .. ..$ PostCode              : chr "B15 2LD"
##   .. ..$ LastChangeDate        : chr "2019-06-04"
##   .. ..$ PrimaryRoleId         : chr "RO104"
##   .. ..$ PrimaryRoleDescription: chr "SOCIAL CARE PROVIDER"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/C07D"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "ASTLEY CARE HOMES LTD"
##   .. ..$ OrgId                 : chr "A5GA"
##   .. ..$ Status                : chr "Active"
##   .. ..$ OrgRecordClass        : chr "RC1"
##   .. ..$ PostCode              : chr "B15 2PN"
##   .. ..$ LastChangeDate        : chr "2016-04-25"
##   .. ..$ PrimaryRoleId         : chr "RO104"
##   .. ..$ PrimaryRoleDescription: chr "SOCIAL CARE PROVIDER"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/A5GA"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "ATOZ INTERPRETING &amp; TRANSLATION SERVICES LTD"
##   .. ..$ OrgId                 : chr "8JG87"
##   .. ..$ Status                : chr "Active"
##   .. ..$ OrgRecordClass        : chr "RC1"
##   .. ..$ PostCode              : chr "B15 2LL"
##   .. ..$ LastChangeDate        : chr "2016-03-14"
##   .. ..$ PrimaryRoleId         : chr "RO157"
##   .. ..$ PrimaryRoleDescription: chr "NON-NHS ORGANISATION"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/8JG87"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "ATTWOOD GREEN HEALTH CENTRE"
##   .. ..$ OrgId                 : chr "5MXK8"
##   .. ..$ Status                : chr "Active"
##   .. ..$ OrgRecordClass        : chr "RC2"
##   .. ..$ PostCode              : chr "B15 1LZ"
##   .. ..$ LastChangeDate        : chr "2013-05-08"
##   .. ..$ PrimaryRoleId         : chr "RO180"
##   .. ..$ PrimaryRoleDescription: chr "PRIMARY CARE TRUST SITE"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/5MXK8"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "ATTWOOD GREEN HEALTH CENTRE"
##   .. ..$ OrgId                 : chr "RXKA3"
##   .. ..$ Status                : chr "Active"
##   .. ..$ OrgRecordClass        : chr "RC2"
##   .. ..$ PostCode              : chr "B15 1LZ"
##   .. ..$ LastChangeDate        : chr "2018-05-16"
##   .. ..$ PrimaryRoleId         : chr "RO198"
##   .. ..$ PrimaryRoleDescription: chr "NHS TRUST SITE"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RXKA3"
##   ..$ :List of 9
##   .. ..$ Name                  : chr "ATTWOOD GREEN HEALTH CENTRE"
##   .. ..$ OrgId                 : chr "V28579"
##   .. ..$ Status                : chr "Active"
##   .. ..$ OrgRecordClass        : chr "RC1"
##   .. ..$ PostCode              : chr "B15 1LZ"
##   .. ..$ LastChangeDate        : chr "2016-07-07"
##   .. ..$ PrimaryRoleId         : chr "RO110"
##   .. ..$ PrimaryRoleDescription: chr "GENERAL DENTAL PRACTICE"
##   .. ..$ OrgLink               : chr "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/V28579"
```


???

+ Decode the reply and we get a list of 20 lists
+ Each list is the information about one organisation

---


```r
library(jsonlite)
API.decoded &lt;- fromJSON(content(API.raw, 'text'))
```

<div id="htmlwidget-a99d01f01aef768602ff" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a99d01f01aef768602ff">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],["115 GOUGH ROAD","115 GOUGH ROAD (CARE HOME)","21A ELVETHAM ROAD","21B ELVETHAM ROAD","21 ELVETHAM ROAD","22A &amp; 22B ELVETHAM ROAD","27 HIGHFIELD ROAD","ADDICTIVE BEHAVIOURS UNIT (CHURCH RD)","ALLENBROOK HOME (HALESOWEN) LTD","ALLIANCE MEDICAL MRI SERVICE - BIRMINGHAM","AMBERLEIGH CARE HOME LTD","ANNIE BRIGHT","ANNIE BRIGHT WESTON HOUSE","AQP ANTICOAG QE HERITAGE BUILDING","ASPEN HILL HEALTHCARE LIMITED","ASTLEY CARE HOMES LTD","ATOZ INTERPRETING &amp; TRANSLATION SERVICES LTD","ATTWOOD GREEN HEALTH CENTRE","ATTWOOD GREEN HEALTH CENTRE","ATTWOOD GREEN HEALTH CENTRE"],["VL8YY","VL8YE","VLQYV","VLQYW","VLW3V","RWLC6","Q2701","RXT02","AYR6","NT941","APQJ","VL8W0","VL4YJ","Y04762","C07D","A5GA","8JG87","5MXK8","RXKA3","V28579"],["Active","Inactive","Inactive","Inactive","Active","Inactive","Inactive","Active","Active","Active","Inactive","Inactive","Inactive","Active","Active","Active","Active","Active","Active","Active"],["RC1","RC1","RC1","RC1","RC1","RC2","RC2","RC2","RC1","RC2","RC1","RC1","RC1","RC1","RC1","RC1","RC1","RC2","RC2","RC1"],["B15 2JG","B15 2JG","B15 2LY","B15 2LY","B15 2LY","B15 2LY","B15 3DP","B15 3SR","B15 3HN","B15 2QQ","B15 3UR","B15 3QD","B15 3QD","B15 2WB","B15 2LD","B15 2PN","B15 2LL","B15 1LZ","B15 1LZ","B15 1LZ"],["2019-07-19","2018-11-26","2018-11-26","2018-11-26","2019-07-19","2013-05-08","2013-05-08","2013-05-08","2019-06-04","2016-03-23","2019-07-18","2018-11-26","2018-11-26","2018-04-18","2019-06-04","2016-04-25","2016-03-14","2013-05-08","2018-05-16","2016-07-07"],["RO101","RO101","RO101","RO101","RO101","RO198","RO136","RO198","RO104","RO176","RO104","RO101","RO101","RO177","RO104","RO104","RO157","RO180","RO198","RO110"],["SOCIAL CARE SITE","SOCIAL CARE SITE","SOCIAL CARE SITE","SOCIAL CARE SITE","SOCIAL CARE SITE","NHS TRUST SITE","STRATEGIC HEALTH AUTHORITY SITE","NHS TRUST SITE","SOCIAL CARE PROVIDER","INDEPENDENT SECTOR H/C PROVIDER SITE","SOCIAL CARE PROVIDER","SOCIAL CARE SITE","SOCIAL CARE SITE","PRESCRIBING COST CENTRE","SOCIAL CARE PROVIDER","SOCIAL CARE PROVIDER","NON-NHS ORGANISATION","PRIMARY CARE TRUST SITE","NHS TRUST SITE","GENERAL DENTAL PRACTICE"],["https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VL8YY","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VL8YE","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VLQYV","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VLQYW","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VLW3V","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RWLC6","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/Q2701","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RXT02","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/AYR6","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/NT941","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/APQJ","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VL8W0","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VL4YJ","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/Y04762","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/C07D","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/A5GA","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/8JG87","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/5MXK8","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RXKA3","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/V28579"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Name<\/th>\n      <th>OrgId<\/th>\n      <th>Status<\/th>\n      <th>OrgRecordClass<\/th>\n      <th>PostCode<\/th>\n      <th>LastChangeDate<\/th>\n      <th>PrimaryRoleId<\/th>\n      <th>PrimaryRoleDescription<\/th>\n      <th>OrgLink<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollY":300,"scrollX":true,"dom":"<'top'>t<'bottom'>ip","order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>

???

+ Replies are JSON objects
+ jsonlite reads them really well
+ gives a data.frame instead of lists of lists.
+ There are more than 20. This is default reply number.
+ Need to add another parameter to get more

---


```r
parameters &lt;- list(PostCode = "B15",
                   Limit = 100)

url &lt;- "https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations?"
API.raw &lt;- GET(url = url, query = parameters)
```

<div id="htmlwidget-c32131839332acd9a975" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c32131839332acd9a975">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],["115 GOUGH ROAD","115 GOUGH ROAD (CARE HOME)","21A ELVETHAM ROAD","21B ELVETHAM ROAD","21 ELVETHAM ROAD","22A &amp; 22B ELVETHAM ROAD","27 HIGHFIELD ROAD","ADDICTIVE BEHAVIOURS UNIT (CHURCH RD)","ALLENBROOK HOME (HALESOWEN) LTD","ALLIANCE MEDICAL MRI SERVICE - BIRMINGHAM","AMBERLEIGH CARE HOME LTD","ANNIE BRIGHT","ANNIE BRIGHT WESTON HOUSE","AQP ANTICOAG QE HERITAGE BUILDING","ASPEN HILL HEALTHCARE LIMITED","ASTLEY CARE HOMES LTD","ATOZ INTERPRETING &amp; TRANSLATION SERVICES LTD","ATTWOOD GREEN HEALTH CENTRE","ATTWOOD GREEN HEALTH CENTRE","ATTWOOD GREEN HEALTH CENTRE","ATTWOOD GREEN HEALTH CENTRE (ATTWOOD GREEN)","ATTWOOD GREEN HEALTH CENTRE (HEALTHHARMONIE)","ATTWOOD GREEN PHARMACY","ATTWOOD GREEN PRIMARY CARE CENTRE","ATTWOOOD GREEN HEALTH CENTRE","AUDLEY CARE LTD - AUDLEY CARE ST GEORGES PLACE","AUTISM WEST MIDLANDS","BARBERRY CENTRE","BARCHESTER EDGBASTON BEAUMONT","BATH ROW MEDICAL PRACTICE","BERKSHIRE OPHTHALMOLOGY SERVICE","BIRMINGHAM 7 (EDGBASTON) PCG","BIRMINGHAM CITY UNIVERSITY","BIRMINGHAM MEDICAL FACILITY","BIRMINGHAM MEDICAL PHYSICS SERVICES","BIRMINGHAM PET CENTRE","BIRMINGHAM RESEARCH PARK - PAN BIRMINGHAM CANCER NETWORK","BIRMINGHAM VINCENT DRIVE (NATIONAL BLOOD SERVICE)","BIRMINGHAM VINCENT DRIVE (NHS BLOOD &amp; TRANPLANT)","BIRMINGHAM WOMEN'S HOSPITAL","BIRMINGHAM WOMEN'S HOSPITAL","BIRMINGHAM WOMEN'S LABORATORY","BIRMINGHAM WOMEN'S NHS FOUNDATION TRUST","BLUEFISH INTELLIGENCE LTD","BMG RESEARCH LTD","BMI EDGBASTON HOSPITAL","BMI EDGBASTON HOSPITAL","BMI THE EDGBASTON HOSPITAL","BOOTS UK LIMITED","BRINDLEY MEDICAL LIMITED","BRINDLEY MEDICAL LIMITED","BRINDLEYS QUALITY CARE LIMITED","CAREBRIGHT EVESHAM LIMITED","CARE FERTILITY (BIRMINGHAM)","CAVENDISH IMAGING BIRMINGHAM","CENTRAL ENGLAND EYE SURGEONS","CHAMBER OF COMMERCE &amp; INDUSTRY","CLINICAL PARTNERS BIRMINGHAM","COLSTON HEALTH CENTRE","COLSTON HEALTH CENTRE","COLSTON HEALTH CENTRE","COMMUNITY DERMATOLOGY SERVICE","CONSULTANT LED DERMATOLOGY SERVICE","DENMARK HOUSE","DENTAL SURGERY","DENTAL SURGERY","DENTAL SURGERY","DIAGNOSTIC WORLD LTD","DIAGNOSTIC WORLD LTD","DIGNIO LTD","DISSCBAND LTD","EDGBASTON BEAUMONT DCA","EDGBASTON EYE CLINIC","EDGBASTON EYE CLINIC - 38 HARBORNE ROAD","ELVETHAM ROAD","EYE OPTICIANS","EYE OPTICIANS - EDGBASTON","FAULD HOUSE CARE HOME LTD","FOCAL SOFTWARE LIMITED","FOODNET TEAM-BIRMINGHAM EAST &amp; NORTH PCT","FRANTZ FANON","GATEWAY FAMILY SERVICES CIC","HEALTHHARMONIE","HEALTH HARMONIE GYNAECOLOGY","HEALTHHARMONIE LIMITED","HEALTHHARMONIE LIMITED HQ","HERTS VALLEY COMMUNITY DERMATOLOGY HH","HIGHFIELD ROAD","IE DESIGN CONSULTANCY LTD","INHEALTH - THE BIRMINGHAM UPRIGHT MRI CENTRE","JAMES BRINDLEY SCHOOL","JAMES BRINDLEY SCHOOL - EDGBASTON","KERRIA COURT","LEARNING DISABILITY ENGLAND","LIFELINE","MARIANA NJIE LIMITED","MARIE STOPES INTERNATIONAL BIRMINGHAM CENTRE","MILLNS KATE (CHIROPODIST)","M&amp;N HEALTHCARE EDGBASTON","MODALITY ATTWOOD GREEN"],["VL8YY","VL8YE","VLQYV","VLQYW","VLW3V","RWLC6","Q2701","RXT02","AYR6","NT941","APQJ","VL8W0","VL4YJ","Y04762","C07D","A5GA","8JG87","5MXK8","RXKA3","V28579","NQT61","NO017","FD732","RYW51","04XAC","VN5VV","8JM05","RXTD3","VLM9R","M85025","Y05973","4YH82","5MXA2","A91157","8E887","NT947","5M17C","T129P","T146P","RLU01","RQ370","696K0","RLU","8JE51","8HW81","NV13T","RRJ28","NT445","FKD18","C03Q","VNCVN","AXGJ","C02R","DXC07","AGF03","8E845","RYW1E","DL503","5MX33","M85816","RWL33","Y02426","Y05373","RXT97","V01186","V01208","V01224","NEP","NEP01","8KD15","P47Y","VN3R5","T3KL","TP8N9","5M1C6","T1Y8","TP06P","C0V8","8K329","5PG1E","RXT23","8K228","8HG92","Y05723","NO0","NO001","Y06353","Q3401","8HW49","NV14W","DNX","DNX01","VL8VY","8K284","Y00970","AWNH","NTG50","8G619","VN8HJ","M85124001"],["Active","Inactive","Inactive","Inactive","Active","Inactive","Inactive","Active","Active","Active","Inactive","Inactive","Inactive","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Inactive","Active","Active","Active","Active","Active","Inactive","Active","Active","Active","Active","Active","Active","Active","Inactive","Inactive","Active","Inactive","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Inactive","Inactive","Active","Active","Active","Active","Active","Inactive","Active","Active","Active","Inactive","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Active","Inactive","Active","Active","Active","Active","Active"],["RC1","RC1","RC1","RC1","RC1","RC2","RC2","RC2","RC1","RC2","RC1","RC1","RC1","RC1","RC1","RC1","RC1","RC2","RC2","RC1","RC2","RC2","RC1","RC2","RC2","RC1","RC1","RC2","RC1","RC1","RC1","RC1","RC2","RC1","RC1","RC2","RC2","RC2","RC2","RC2","RC2","RC1","RC1","RC1","RC1","RC2","RC2","RC2","RC1","RC1","RC1","RC1","RC1","RC2","RC2","RC1","RC2","RC2","RC2","RC1","RC2","RC1","RC1","RC2","RC1","RC1","RC1","RC1","RC2","RC1","RC1","RC1","RC1","RC1","RC2","RC1","RC1","RC1","RC1","RC2","RC2","RC1","RC1","RC1","RC1","RC2","RC1","RC2","RC1","RC2","RC1","RC2","RC1","RC1","RC1","RC1","RC2","RC1","RC1","RC2"],["B15 2JG","B15 2JG","B15 2LY","B15 2LY","B15 2LY","B15 2LY","B15 3DP","B15 3SR","B15 3HN","B15 2QQ","B15 3UR","B15 3QD","B15 3QD","B15 2WB","B15 2LD","B15 2PN","B15 2LL","B15 1LZ","B15 1LZ","B15 1LZ","B15 1LZ","B15 1LZ","B15 1LZ","B15 1LZ","B15 1LZ","B15 3SH","B15 1NU","B15 2SG","B15 2NX","B15 1LZ","B15 3BU","B15 2TL","B15 3TN","B15 2WB","B15 2TH","B15 2TH","B15 2SQ","B15 2SG","B15 2SG","B15 2TG","B15 2TG","B15 2TG","B15 2TG","B15 1TH","B15 3BE","B15 2QQ","B15 2QQ","B15 2QQ","B15 1DT","B15 3ES","B15 3ES","B15 2LD","B15 1TH","B15 3DP","B15 3SJ","B15 2JJ","B15 3DH","B15 3HE","B15 1LZ","B15 1LZ","B15 1LZ","B15 3BU","B15 3BU","B15 2TH","B15 1LD","B15 3HN","B15 3HE","B15 2SQ","B15 2SQ","B15 2GW","B15 2DZ","B15 2NX","B15 3HE","B15 3HE","B15 2LY","B15 1LD","B15 1LD","B15 3HN","B15 2GE","B15 3DH","B15 3AU","B15 3DH","B15 1NP","B15 3BU","B15 3BU","B15 3BU","B15 3BU","B15 3DP","B15 1TS","B15 1TS","B15 2AF","B15 2AF","B15 2DY","B15 2SQ","B15 1NE","B15 1TH","B15 2UL","B15 3HG","B15 1TH","B15 1LZ"],["2019-07-19","2018-11-26","2018-11-26","2018-11-26","2019-07-19","2013-05-08","2013-05-08","2013-05-08","2019-06-04","2016-03-23","2019-07-18","2018-11-26","2018-11-26","2018-04-18","2019-06-04","2016-04-25","2016-03-14","2013-05-08","2018-05-16","2016-07-07","2019-08-19","2016-03-23","2019-03-13","2012-09-14","2018-04-19","2019-07-01","2016-11-21","2013-05-08","2019-07-19","2018-04-18","2018-04-18","2014-04-16","2013-05-08","2018-03-27","2016-03-23","2016-03-23","2013-03-27","2012-05-15","2012-05-15","2017-02-01","2016-12-05","2017-01-30","2017-02-01","2015-10-23","2019-06-03","2018-03-14","2014-04-09","2016-03-23","2015-08-19","2019-06-07","2019-07-01","2019-06-06","2019-06-07","2019-03-21","2016-03-23","2016-03-23","2013-05-08","2017-11-20","2013-05-08","2014-11-28","2013-05-08","2018-10-31","2018-04-18","2013-05-08","2016-07-07","2016-07-07","2015-02-09","2019-04-15","2017-05-31","2019-07-24","2019-03-20","2019-07-01","2018-03-06","2018-04-19","2013-05-08","2013-05-08","2016-03-23","2019-10-21","2018-08-01","2013-05-08","2013-05-08","2018-06-25","2016-03-23","2017-04-03","2019-05-23","2016-03-23","2019-02-07","2013-12-10","2016-03-23","2019-04-04","2018-04-16","2018-04-16","2019-07-15","2018-07-17","2018-07-04","2019-06-06","2016-03-23","2016-03-23","2019-07-01","2019-01-21"],["RO101","RO101","RO101","RO101","RO101","RO198","RO136","RO198","RO104","RO176","RO104","RO101","RO101","RO177","RO104","RO104","RO157","RO180","RO198","RO110","RO176","RO176","RO182","RO198","RO99","RO101","RO157","RO198","RO101","RO177","RO177","RO171","RO180","RO177","RO157","RO176","RO180","RO191","RO191","RO198","RO198","RO173","RO197","RO157","RO157","RO176","RO198","RO176","RO182","RO104","RO101","RO104","RO104","RO176","RO176","RO157","RO198","RO176","RO180","RO177","RO198","RO177","RO177","RO198","RO110","RO110","RO110","RO172","RO176","RO157","RO181","RO101","RO166","RO167","RO180","RO166","RO167","RO104","RO157","RO180","RO198","RO157","RO157","RO177","RO172","RO176","RO177","RO136","RO157","RO176","RO172","RO176","RO101","RO157","RO177","RO104","RO176","RO157","RO101","RO96"],["SOCIAL CARE SITE","SOCIAL CARE SITE","SOCIAL CARE SITE","SOCIAL CARE SITE","SOCIAL CARE SITE","NHS TRUST SITE","STRATEGIC HEALTH AUTHORITY SITE","NHS TRUST SITE","SOCIAL CARE PROVIDER","INDEPENDENT SECTOR H/C PROVIDER SITE","SOCIAL CARE PROVIDER","SOCIAL CARE SITE","SOCIAL CARE SITE","PRESCRIBING COST CENTRE","SOCIAL CARE PROVIDER","SOCIAL CARE PROVIDER","NON-NHS ORGANISATION","PRIMARY CARE TRUST SITE","NHS TRUST SITE","GENERAL DENTAL PRACTICE","INDEPENDENT SECTOR H/C PROVIDER SITE","INDEPENDENT SECTOR H/C PROVIDER SITE","PHARMACY","NHS TRUST SITE","CLINICAL COMMISSIONING GROUP SITE","SOCIAL CARE SITE","NON-NHS ORGANISATION","NHS TRUST SITE","SOCIAL CARE SITE","PRESCRIBING COST CENTRE","PRESCRIBING COST CENTRE","PRIMARY CARE GROUP","PRIMARY CARE TRUST SITE","PRESCRIBING COST CENTRE","NON-NHS ORGANISATION","INDEPENDENT SECTOR H/C PROVIDER SITE","PRIMARY CARE TRUST SITE","SPECIAL HEALTH AUTHORITY SITE","SPECIAL HEALTH AUTHORITY SITE","NHS TRUST SITE","NHS TRUST SITE","PATHOLOGY LAB","NHS TRUST","NON-NHS ORGANISATION","NON-NHS ORGANISATION","INDEPENDENT SECTOR H/C PROVIDER SITE","NHS TRUST SITE","INDEPENDENT SECTOR H/C PROVIDER SITE","PHARMACY","SOCIAL CARE PROVIDER","SOCIAL CARE SITE","SOCIAL CARE PROVIDER","SOCIAL CARE PROVIDER","INDEPENDENT SECTOR H/C PROVIDER SITE","INDEPENDENT SECTOR H/C PROVIDER SITE","NON-NHS ORGANISATION","NHS TRUST SITE","INDEPENDENT SECTOR H/C PROVIDER SITE","PRIMARY CARE TRUST SITE","PRESCRIBING COST CENTRE","NHS TRUST SITE","PRESCRIBING COST CENTRE","PRESCRIBING COST CENTRE","NHS TRUST SITE","GENERAL DENTAL PRACTICE","GENERAL DENTAL PRACTICE","GENERAL DENTAL PRACTICE","INDEPENDENT SECTOR HEALTHCARE PROVIDER","INDEPENDENT SECTOR H/C PROVIDER SITE","NON-NHS ORGANISATION","PHARMACY HEADQUARTER","SOCIAL CARE SITE","OPTICAL HEADQUARTERS","OPTICAL SITE","PRIMARY CARE TRUST SITE","OPTICAL HEADQUARTERS","OPTICAL SITE","SOCIAL CARE PROVIDER","NON-NHS ORGANISATION","PRIMARY CARE TRUST SITE","NHS TRUST SITE","NON-NHS ORGANISATION","NON-NHS ORGANISATION","PRESCRIBING COST CENTRE","INDEPENDENT SECTOR HEALTHCARE PROVIDER","INDEPENDENT SECTOR H/C PROVIDER SITE","PRESCRIBING COST CENTRE","STRATEGIC HEALTH AUTHORITY SITE","NON-NHS ORGANISATION","INDEPENDENT SECTOR H/C PROVIDER SITE","INDEPENDENT SECTOR HEALTHCARE PROVIDER","INDEPENDENT SECTOR H/C PROVIDER SITE","SOCIAL CARE SITE","NON-NHS ORGANISATION","PRESCRIBING COST CENTRE","SOCIAL CARE PROVIDER","INDEPENDENT SECTOR H/C PROVIDER SITE","NON-NHS ORGANISATION","SOCIAL CARE SITE","BRANCH SURGERY"],["https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VL8YY","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VL8YE","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VLQYV","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VLQYW","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VLW3V","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RWLC6","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/Q2701","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RXT02","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/AYR6","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/NT941","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/APQJ","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VL8W0","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VL4YJ","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/Y04762","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/C07D","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/A5GA","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/8JG87","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/5MXK8","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RXKA3","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/V28579","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/NQT61","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/NO017","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/FD732","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RYW51","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/04XAC","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VN5VV","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/8JM05","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RXTD3","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VLM9R","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/M85025","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/Y05973","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/4YH82","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/5MXA2","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/A91157","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/8E887","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/NT947","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/5M17C","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/T129P","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/T146P","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RLU01","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RQ370","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/696K0","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RLU","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/8JE51","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/8HW81","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/NV13T","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RRJ28","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/NT445","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/FKD18","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/C03Q","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VNCVN","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/AXGJ","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/C02R","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/DXC07","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/AGF03","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/8E845","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RYW1E","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/DL503","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/5MX33","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/M85816","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RWL33","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/Y02426","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/Y05373","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RXT97","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/V01186","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/V01208","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/V01224","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/NEP","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/NEP01","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/8KD15","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/P47Y","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VN3R5","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/T3KL","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/TP8N9","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/5M1C6","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/T1Y8","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/TP06P","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/C0V8","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/8K329","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/5PG1E","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/RXT23","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/8K228","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/8HG92","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/Y05723","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/NO0","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/NO001","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/Y06353","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/Q3401","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/8HW49","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/NV14W","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/DNX","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/DNX01","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VL8VY","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/8K284","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/Y00970","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/AWNH","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/NTG50","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/8G619","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/VN8HJ","https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations/M85124001"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Name<\/th>\n      <th>OrgId<\/th>\n      <th>Status<\/th>\n      <th>OrgRecordClass<\/th>\n      <th>PostCode<\/th>\n      <th>LastChangeDate<\/th>\n      <th>PrimaryRoleId<\/th>\n      <th>PrimaryRoleDescription<\/th>\n      <th>OrgLink<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollY":300,"scrollX":true,"dom":"<'top'>t<'bottom'>ip","order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>

???

+ Adding parameters to the url gets stupid.
+ GET has a query argument for this
+ Same postcode, added 'limit' of 100.
+ Get 100 organisations instead of 20.

---

## Lessons Learned

???

Some helpful tips I have picked up.

--

- .large-text[Each API has its own rules, parameters and formats.]

--

- .large-text[JSON is common but you may find XML, CSV and others.]

--

- .large-text[Some APIs require an identifier token. Use httr to include it in the GET request.]

--

- .large-text[An undocumented API is worse than useless]

--

- .large-text[For large data sets it is **much** faster to download one large file than to make lots of API requests. Use TRUD.]


---

## nhsODS R Package

???

Used this to create an R package...

--

.pull-left[
![Professionally made nhsODS hex logo](pres-figure/nhsODS_logo.png)

]

???

still needs a little work

--

.pull-right[
- Download updated organisation details
- Read TRUD XML files into a relational database structure
- Combine TRUD data with:
  * OS grid numbers
  * GPS coordinates
  * STP organisation
  * Post code based political boundaries
- Still not affiliated with the ODS
]

--


```r
library(devtools)
install_github(repo = "BassEngD/nhsODS") # Currently a private repo. Need permission to release.
```

---

## Download Organisation Details




```r
RRK_details &lt;- get_organisation_details("RRK")
```

<div id="htmlwidget-f7e4571f2198e3c4eb45" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f7e4571f2198e3c4eb45">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8"],["organisation_details","organisation_dates","organisation_roles","organisation_role_dates","organisation_relationships","organisation_relationship_dates","organisation_successors","organisation_successor_dates"],[1,1,3,3,1,8,2,2],[16,4,5,4,5,4,3,4]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>data.frame<\/th>\n      <th>observations<\/th>\n      <th>variables<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"searching":false,"dom":"<'top'>t<'bottom'>","columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

---

## APIs in R

.large-text[
- APIs let programs talk to each other
- `R` can talk to web-based APIs with `httr`
- `GET()` to request data
- `content()` to read the reply
- Reply can be: JSON, XML, csv, and many more
- Parse the reply into an R-readable format
- Make packages of useful functions for important APIs
]
Examples: `fingertipsR`, `SPARQL`, `gmailr`

Email: Matthew.Bass@uhb.nhs.uk
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create();
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
